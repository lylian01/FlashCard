@model FlashCard.Models.Flashcard
<style>
    /* btn isPublic*/
    .toggle-public {
        display: none;
    }

    .btn-toggle {
        gap: 3px;
        padding: 5px 10px;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
    }

        .btn-toggle.active {
            background: #28a745;
            color: white;
        }

        .btn-toggle.inactive {
            background: var(--secondary-dark);
            color: white;
        }
        /* button custom */
        .btn-secondary-dark {
            background-color: var(--secondary-dark);
            color: white;
            border: none;
        }

            .btn-secondary-dark:hover {
                background-color: var(--secondary);
            }
</style>
<form asp-action="Edit" method="post" class="card p-3 rounded-2">
    <input type="hidden" asp-for="CardId" />
    <input type="hidden" asp-for="UserId" />

    <div class="d-flex align-items-center justify-content-between">
        <div class="form-group form-check p-0 m-0 mb-2">
            <h3 class="fw-bold" style="color: var(--accent);">Edit flashcard </h3>
            <input asp-for="IsPublic" class="toggle-public" type="checkbox" id="togglePublic" checked />
            <label for="togglePublic" class="btn-toggle active pe-4">
                <span id="toggleIcon">🌍</span>
                <span id="toggleText">Public</span>
            </label>
        </div>
        <div >
            <input type="submit" value="Save" class="btn btn-primary rounded-pill px-5 py-1" />
        </div>
    </div>
    <div class="form-group mb-3">
        <label class="me-2" asp-for="CardTitle">Title </label>
        <input asp-for="CardTitle" class="form-control" />
    </div>
        <div class="form-group mb-3">
        <label class=" mb-1" asp-for="DeckId">Deck</label>
        <select asp-for="DeckId" asp-items="ViewBag.DeckId" class="form-control">
                <option value="">-- Deck --</option>
        </select>
        </div>
    <div class="form-group mb-3">
        <label class="mb-1" asp-for="CardDescription">Description</label>
        <textarea asp-for="CardDescription" class="form-control"></textarea>
    </div>
    <h4 class="fw-bold" style="color: var(--accent);">List of cards </h4>
    <div id="cardPairsContainer" class="p-3 rounded-3" style="background:var(--primary)">
        @for (int i = 0; i < Model.CardPairs.Count; i++)
        {
            <div>
                <div class="card-pair row gap-2 m-auto mb-1 p-2 rounded-3 form-group">
                    <input asp-for="CardPairs[@i].FrontCard" class="form-control col border-0 rounded-3" />
                    <input asp-for="CardPairs[@i].BackCard" class="form-control  col border-0 rounded-3" />
                    <button type="button" class="btn btn-danger removePair col-1 ">
                        <i class="bi bi-trash3 "></i>
                    </button>
                </div>
            </div>
        }
    </div>

    <button type="button" class="btn btn-secondary-dark mt-2 mx-auto rounded-pill" style="width:200px" id="addPairBtn">+ Add more card pairs</button>

    <div class="form-group mt-2 d-flex justify-content-end">
        <input type="submit" value="Save" class="btn btn-primary rounded-pill px-5 py-3" />
    </div>
</form>
<script>
    const container = document.getElementById("cardPairsContainer");
    const addBtn = document.getElementById("addPairBtn");

    function reindexPairs() {
        const pairs = container.querySelectorAll(".card-pair");
        pairs.forEach((pair, i) => {
            pair.querySelectorAll("input").forEach(input => {
                input.name = input.name.replace(/\[\d+\]/, `[${i}]`);
            });
        });
    }

    function addRemoveEvent(btn) {
        btn.addEventListener("click", e => {
            e.target.closest(".card-pair").remove();
            reindexPairs();
        });
    }

    // Thêm sự kiện xóa cho cặp hiện có
    document.querySelectorAll(".removePair").forEach(addRemoveEvent);

    addBtn.addEventListener("click", function () {
        const index = container.children.length;
        const div = document.createElement("div");
        div.innerHTML = `
            <div class="card-pair row gap-2 m-auto mb-1 p-2 rounded-3" >
                <input name="CardPairs[${index}].FrontCard" class="form-control col border-0 rounded-3" />
                <input name="CardPairs[${index}].BackCard" class="form-control  col border-0 rounded-3" />
                <button type="button" class="btn btn-danger removePair col-1 ">
                    <i class="bi bi-trash3 "></i>
                </button>
            </div>
        `;
        container.append(div);
        addRemoveEvent(div.querySelector(".removePair"));
        reindexPairs();
    });

    const checkbox = document.getElementById('togglePublic');
    const toggleButton = document.querySelector('.btn-toggle');
    const toggleIcon = document.getElementById('toggleIcon');
    const toggleText = document.getElementById('toggleText');
    var isPublic = @Model.IsPublic.ToString().ToLower();

    if (isPublic){
        toggleButton.classList.remove('inactive');
        toggleButton.classList.add('active');
        toggleIcon.textContent = '🌍';
        toggleText.textContent = 'Public';
    }
    else{
        console.log('not checked');
        toggleButton.classList.remove('active');
        toggleButton.classList.add('inactive');
        toggleIcon.textContent = '🔒';
        toggleText.textContent = 'UnPublic';
    }
    checkbox.addEventListener('change', function() {
        if (this.checked) {
            toggleButton.classList.remove('inactive');
            toggleButton.classList.add('active');
            toggleIcon.textContent = '🌍';
            toggleText.textContent = 'Public';
        } else {
            toggleButton.classList.remove('active');
            toggleButton.classList.add('inactive');
            toggleIcon.textContent = '🔒';
            toggleText.textContent = 'UnPublic';
        }
    });
</script>
@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
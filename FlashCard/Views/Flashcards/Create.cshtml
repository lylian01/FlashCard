@model FlashCard.Models.Flashcard

@{
    ViewData["Title"] = "Create";
}
<style>
    /* màu chữ */
    .text-accent {
        color: var(--accent);
    }

    .text-accent-dark {
        color: var(--accent-dark);
    }

    /* btn isPublic*/
    .toggle-public {
        display: none;
    }

    .btn-toggle {
        gap: 3px;
        padding: 5px 10px;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
    }

        .btn-toggle.active {
            background: #28a745;
            color: white;
        }

        .btn-toggle.inactive {
            background: var(--secondary-dark);
            color: white;
        }

    /* button custom */
    .btn-secondary-dark {
        background-color: var(--secondary-dark);
        color: white;
        border: none;
    }

        .btn-secondary-dark:hover {
            background-color: var(--secondary);
        }

</style>

<form asp-action="Create" method="post" class="card shadow-sm border-0 p-4">
    <input type="hidden" asp-for="UserId" class="form-control" value="@ViewBag.UserId" readonly />
    <div>
        <h3 class="text-accent fw-bold"> Tạo flashcard </h3>
        <div class="mb-3 form-check p-0">
            <input asp-for="IsPublic" class="toggle-public" type="checkbox" id="togglePublic" checked />
            <label for="togglePublic" class="btn-toggle active">
                <span id="toggleIcon">🌍</span>
                <span id="toggleText">Công khai</span>
            </label>
        </div>
    </div>
    <div class="mb-3">
        <label asp-for="CardTitle" class="form-label fw-semibold">Nhập tiêu đề </label>
        <input asp-for="CardTitle" class="form-control" placeholder="Nhập tiêu đề" />
    </div>
    <div class="mb-3">
        <label asp-for="CardDescription" class="form-label fw-semibold"> Nhập thêm mô tả</label>
        <textarea asp-for="CardDescription" class="form-control" rows="3" placeholder="Mô tả thêm..."></textarea>
    </div>

    <div class="mb-3">
        <label asp-for="DeckId" class="form-label fw-semibold"> Chọn danh mục</label>
        <select asp-for="DeckId" class="form-control" asp-items="ViewBag.DeckId">
            <option value="">-- Chọn Deck --</option>
        </select>
    </div>

    <h3 class="text-accent fw-bold">Danh sách thẻ</h3>

    <div id="cardPairsContainer">
        @for (int i = 0; i < Model.CardPairs.Count; i++)
        {
            <div class="card-pair row gap-2 m-auto mb-2 p-2 rounded-3" style="background:var(--primary)">
                <span id="cardPardStt" class=" fw-bold"> @(i+1) </span>
                <input name="CardPairs[@i].FrontCard" class="form-control col border-0 rounded-3" />
                <input name="CardPairs[@i].BackCard" class="form-control  col border-0 rounded-3" />
                <button type="button" class="btn btn-danger removePair col-1 ">
                    <i class="bi bi-trash3 "></i> 
                </button>
            </div>
        }
    </div>

    <button type="button" class="btn btn-secondary-dark mt-2 mx-auto rounded-pill" style="width:200px" id="addPairBtn">Thêm cặp thẻ</button>

    <div class=" mt-2 d-flex justify-content-end">
        <input type="submit" value="Tạo Flashcard" class="btn btn-primary rounded-pill px-5 py-3" />
    </div>
</form>

<script>
    const container = document.getElementById("cardPairsContainer");
    const addBtn = document.getElementById("addPairBtn");

    function reindexPairs() {
        const pairs = container.querySelectorAll(".card-pair");
        pairs.forEach((pair, i) => {
            pair.querySelectorAll("input").forEach(input => {
                input.name = input.name.replace(/\[\d+\]/, `[${i}]`);
            });
            
        });
        const pairStt = container.querySelectorAll("#cardPardStt");

        pairStt.forEach((pairstt,i)=>{
            pairstt.innerText = i+1
        })
    }

    function addRemoveEvent(btn) {
        btn.addEventListener("click", e => {
            e.target.closest(".card-pair").remove();
            reindexPairs();
        });
    }

    // Thêm sự kiện xóa cho cặp hiện có
    document.querySelectorAll(".removePair").forEach(addRemoveEvent);

    addBtn.addEventListener("click", function () {
        const index = container.children.length;
        const div = document.createElement("div");
        div.classList.add("card-pair", "row" ,"gap-2","m-auto","mb-2" ,"p-2" ,"rounded-3");
        div.style.backgroundColor= "var(--primary)";
        div.innerHTML = `
            <span id="cardPardStt" class="fw-bold"> ${index} </span>
            <input name="CardPairs[${index}].FrontCard" class="form-control col border-0 rounded-3" />
            <input name="CardPairs[${index}].BackCard" class="form-control  col border-0 rounded-3" />
            <button type="button" class="btn btn-danger removePair col-1 "> 
                <i class="bi bi-trash3 "></i> 
            </button>
        `;
        container.append(div);
        addRemoveEvent(div.querySelector(".removePair"));
        reindexPairs();
    });

    const checkbox = document.getElementById('togglePublic');
    const toggleBtn = document.querySelector('.btn-toggle');
    const toggleIcon = document.getElementById('toggleIcon');
    const toggleText = document.getElementById('toggleText');

    checkbox.addEventListener('change', function() {
        if (this.checked) {
            toggleBtn.classList.remove('inactive');
            toggleBtn.classList.add('active');
            toggleIcon.textContent = '🌍';
            toggleText.textContent = 'Công khai';
        } else {
            toggleBtn.classList.remove('active');
            toggleBtn.classList.add('inactive');
            toggleIcon.textContent = '🔒';
            toggleText.textContent = 'Không công khai';
        }
    });
</script>
@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}